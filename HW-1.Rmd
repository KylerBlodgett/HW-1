---
title: "MATH 216 Homework 1"
author: "Kyler Blodgett"
output: html_document
---

```{r, echo=FALSE, message=FALSE}
# DO NOT EDIT THIS SECTION

# Load packages
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(lubridate))
```


```{r, echo=FALSE, message=FALSE, cache=TRUE}
# Load data sets. Note this assumes this .Rmd files is in the same directory as
# the .csv files.
flights <- read.csv("data/flights.csv", stringsAsFactors = FALSE) %>% 
  tbl_df() %>%
  mutate(date=as.Date(date))
weather <- read.csv("data/weather.csv", stringsAsFactors = FALSE) %>% 
  tbl_df() %>%
  mutate(date=as.Date(date))
planes <- read.csv("data/planes.csv", stringsAsFactors = FALSE) %>% 
  tbl_df()
airports <- read.csv("data/airports.csv", stringsAsFactors = FALSE) %>% 
  tbl_df()
states <- read.csv("data/states.csv", stringsAsFactors = FALSE) %>% 
  tbl_df()
```





## Admistrative:

Please indicate

* Who you collaborated with: Christian, Paul, Prof. Kim (so far)
* Roughly how much time you spent on this HW: 7 hours 
* What gave you the most trouble:couting different types of observations within a variable and then making a proportion from that count (see question 1). 
* Any comments you have: Trying not to be frustrated about being frustrated! 





## Question 1:

* Plot a "time series" of the proportion of flights that were delayed by > 30 minutes on each day.  i.e.
    + the x-axis should be some notion of time
    + the y-axis should be the proportion.
* Which seasons did we tend to see the most and least delays of > 30 minutes.

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
flights2 <- 
  mutate(flights, date=months(date)) %>%
  group_by(date) %>%
  tally() %>%
  rename(num_flights = n)

flights_mod <-
  filter(flights, dep_delay>30) %>%
  mutate(date=months(date))%>%
  group_by(date) %>%
  tally() %>%
  rename(num_flights_late = n)

flights_compiled <-
  left_join(flights2, flights_mod, by="date") %>%
  mutate(prop_late = num_flights_late / num_flights) %>%
  select(date, prop_late)
  
ggplot(data=flights_compiled, aes(x=date, y=prop_late)) +
  geom_bar(stat="identity") +
  labs(x= "Month, 2011", y= "Proportion of Flights Delayed by 30+ Min.") +
  ggtitle("Percent of Flights Delayed by Month")
```

June and July experienced the highest proportion of flights delayed by over 30 minutes (13.2% and 12.5% respectively). May and April are the months with the next high proportion of delayed flights by 30 minutes or more, implying that late Spring leading into mid-Summer was the most-delayed time of the year for flights leaving Houston in 2011. 



## Question 2:

Some people prefer flying on older planes.  Even though they aren't as nice,
they tend to have more room.  Which airlines should these people favor?

```{r, echo=FALSE, fig.width=12, fig.height=6}
old_planes <- (left_join(flights, planes, by = "plane") %>%
  select(plane, carrier, year) %>%
  arrange(carrier, year) %>%
  group_by(carrier, year) %>%
  tally () %>%
  rename(num_in_year = n) )
ggplot(data=old_planes, aes(x = year, y = num_in_year, colour = carrier)) +
  geom_bar(stat="identity") + 
  scale_y_log10() +
  facet_wrap(~carrier, nrow=4) +
  ggtitle("Age of Planes by Airline") 
```

From these graphs, we can see visually that the AA airline used the oldest planes  in their departures from the Dallas airport during January 2011. CO and DL also have fairly old fleets for that time window, with some planes made in the 1950s, and hundreds dating back to the 1970s. All other carriers have planes manufactured predominantly since the mid- to late-1980s.





## Question 3:

* What states did listed Southwest Airlines flights tend to fly to?
* What states did all Southwest Airlines flights tend to fly to?


```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
#Part A - Only flight patterns

WN_flights2 <- 
  left_join(flights, airports, by=c("dest"="iata")) %>%
  filter(carrier == "WN")

#unique_WN_flights2 <- 
  #unique(WN_flights2, flight) #Start here, trying to eliminate all repetitive flights
  
#Part B - All flights

WN_flights <- 
  left_join(flights, airports, by=c("dest"="iata")) %>%
  filter(carrier == "WN") %>%
  group_by(state) %>%
  tally() %>%
  rename(num_WN_flights = n) %>%
  mutate(num_WN_flights = num_WN_flights)

ggplot(data=WN_flights, aes(x = state, y= num_WN_flights)) +
  geom_bar(stat="identity") +
  ggtitle("Southwest Flights by State")
```

For part B of this question (considering all Southwest flights), Texas was naturally the most popular state destination from Houston by a factor of over 4 time compared to second most popular state. In decreasing order, Florida, Louisiana and California were the next most popular destinations for Southwest passengers from Houston in 2011. 


## Question 4:

What weather patterns are associated with the biggest departure delays?

```{r, echo=FALSE, message=FALSE, fig.width=12, fig.height=6}
weather_effect <- 
  left_join(flights, weather, by=c("date", "hour")) %>%
  select(date, hour, dep_delay, wind_speed, temp, visibility, conditions)
ggplot(data=weather_effect, aes(x=wind_speed, y=dep_delay)) + #Not enough parameters to include
  #visibility
  geom_point() +
  facet_wrap(~conditions) +
  ggtitle("Departure Delays by Weather")
```

Though this graphic is stil inconclusive, we see that wind speed does not seem to be associated with weather delays. Also, mostly cloudy weather looks visually to have a higher proportion of longer delayed flights (question: Is there a better way to organize this graphic? Feels like I'm trying to juggle several different variables on the same plot)

## Question 5:

I want to know what proportionately regions (NE, south, west, midwest) each 
carrier flies to from Houston in the month of July.  Consider the `month()`
function from the `lubridate` package.

```{r, echo=TRUE, message=FALSE, fig.width=12, fig.height=6}
state_by_region <-
  left_join(airports, states, by="state")

july_flights <-
  left_join(flights, state_by_region, by=c("dest"="iata")) %>%
  select(date, carrier, state, region) %>%
  mutate(date=months(date))%>%
  group_by(date) %>%
  filter(date=="July") 
  #group_by(region) %>%
  #tally()

#ggplot(data=july_flights, aes(x=region, y=..count..)) +
  #geom_bar() +
  #facet_wrap(~carrier, nrows=3)

# Not done with 5 yet, but have the data table as I want it. The commented-out ggplot code isn't working
```
